<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.moondev.blog.mapper.BookMapper">
    <resultMap id="bookMap" type="cn.moondev.blog.model.Book">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="subtitle" property="subtitle"/>
        <result column="author" property="author"/>
        <result column="rating" property="rating"/>
        <result column="tag" property="tag"/>
        <result column="translator" property="translator"/>
        <result column="pages" property="pages"/>
        <result column="douban_id" property="doubanId"/>
        <result column="publisher" property="publisher"/>
        <result column="pubdate" property="pubdate"/>
        <result column="isbn10" property="isbn10"/>
        <result column="isbn13" property="isbn13"/>
        <result column="douban_api" property="doubanApi"/>
        <result column="author_intro" property="authorIntro"/>
        <result column="summary" property="summary"/>
        <result column="douban_image1" property="doubanImage1"/>
        <result column="douban_image2" property="doubanImage2"/>
        <result column="douban_image3" property="doubanImage3"/>
        <result column="backup_image1" property="backupImage1"/>
        <result column="backup_image2" property="backupImage2"/>
        <result column="backup_image3" property="backupImage3"/>
        <result column="douban_url" property="doubanUrl"/>
        <result column="jingdong_url" property="jingdongUrl"/>
        <result column="duokan_url" property="duokanUrl"/>
        <result column="year" property="year"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <select id="count" resultType="java.lang.Long">
        SELECT count(*)
        FROM t_book
        WHERE 1 = 1
        <if test='title != null'>
            AND `title` LIKE "%"#{title}"%"
        </if>
        <if test='author != null'>
            AND `author` LIKE "%"#{author}"%"
        </if>
    </select>

    <select id="find" resultMap="bookMap">
        SELECT *
        FROM t_book
        WHERE 1 = 1
        <if test='title != null'>
            AND `title` LIKE "%"#{title}"%"
        </if>
        <if test='author != null'>
            AND `author` LIKE "%"#{author}"%"
        </if>
        limit #{offset}, #{size}
    </select>

    <select id="year" resultMap="bookMap">
          SELECT title,author,rating,douban_image1,tag,douban_url,jingdong_url,duokan_url,remark
          FROM t_book
          WHERE `year` = #{year}
      </select>

    <select id="findById">
        SELECT * FROM t_book WHERE `douban_id` = #{doubanId}
    </select>

    <delete id="delete" parameterType="java.lang.Long">
          DELETE FROM t_book WHERE `id` = #{id}
      </delete>

    <insert id="upsert" parameterType="cn.moondev.blog.model.Book">
      INSERT INTO t_book (
            `title`,
            `subtitle`,
            `author`,
            `rating`,
            `tag`,
            `translator`,
            `pages`,
            `douban_id`,
            `publisher`,
            `pubdate`,
            `isbn10`,
            `isbn13`,
            `douban_api`,
            `author_intro`,
            `summary`,
            `douban_image1`,
            `douban_image2`,
            `douban_image3`,
            `backup_image1`,
            `backup_image2`,
            `backup_image3`,
            `douban_url`,
            `jingdong_url`,
            `duokan_url`,
            `year`,
            `remark`
      ) VALUES (
            #{item.title},
            #{item.subtitle},
            #{item.author},
            #{item.rating},
            #{item.tag},
            #{item.translator},
            #{item.pages},
            #{item.doubanId},
            #{item.publisher},
            #{item.pubdate},
            #{item.isbn10},
            #{item.isbn13},
            #{item.doubanApi},
            #{item.authorIntro},
            #{item.summary},
            #{item.doubanImage1},
            #{item.doubanImage2},
            #{item.doubanImage3},
            #{item.backupImage1},
            #{item.backupImage2},
            #{item.backupImage3},
            #{item.doubanUrl},
            #{item.jingdongUrl},
            #{item.duokanUrl},
            #{item.year},
            #{item.remark}
      )ON DUPLICATE KEY UPDATE
            `title` = VALUES(title),
            `subtitle` = VALUES(subtitle),
            `author` = VALUES(author),
            `rating` = VALUES(rating),
            `tag` = VALUES(tag),
            `translator` = VALUES(translator),
            `pages` = VALUES(pages),
            `douban_id` = VALUES(douban_id),
            `publisher` = VALUES(publisher),
            `pubdate` = VALUES(pubdate),
            `isbn10` = VALUES(isbn10),
            `isbn13` = VALUES(isbn13),
            `douban_api` = VALUES(douban_api),
            `author_intro` = VALUES(author_intro),
            `summary` = VALUES(summary),
            `douban_image1` = VALUES(douban_image1),
            `douban_image2` = VALUES(douban_image2),
            `douban_image3` = VALUES(douban_image3),
            `backup_image1` = VALUES(backup_image1),
            `backup_image2` = VALUES(backup_image2),
            `backup_image3` = VALUES(backup_image3),
            `douban_url` = VALUES(douban_url),
            `jingdong_url` = VALUES(jingdong_url),
            `duokan_url` = VALUES(duokan_url),
            `year` = VALUES(`year`),
            `remark` = VALUES(remark)
      </insert>
</mapper>